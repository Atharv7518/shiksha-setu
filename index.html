<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shiksha Setu</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background: #f0f2f5; color: #333; }
        header { background: #007bff; color: white; padding: 1rem; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000;}
        header h1 { margin: 0; }
        main { padding: 20px; }
        .view { display: none; }
        .view.active { display: block; }
        button { background: #007bff; color: white; border: none; padding: 12px 20px; cursor: pointer; margin-top: 10px; border-radius: 8px; font-size: 16px; transition: background-color 0.2s; }
        button:hover { background: #0056b3; }
        .logout-btn { background: #dc3545; }
        .logout-btn:hover { background: #c82333; }
        input, select, textarea { display: block; margin: 10px 0; padding: 10px; width: 100%; max-width: 400px; border: 1px solid #ccc; border-radius: 5px; }
        section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        h2, h3 { color: #0056b3; }
        ul { list-style: none; padding: 0; }
        ul li { margin: 8px 0; padding: 5px; cursor: pointer; color: #007bff; }
        ul li:hover { text-decoration: underline; background-color: #f8f9fa; }
        #languageSwitcher { position: absolute; top: 15px; right: 20px; padding: 5px; border-radius: 5px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    </style>
</head>
<body>

    <header>
        <h1 data-translate="app_title">Shiksha Setu</h1>
        <select id="languageSwitcher">
            <option value="en">English</option>
            <option value="hi">हिंदी</option>
            <option value="pa">ਪੰਜਾਬੀ</option>
        </select>
    </header>

    <main id="app">
        <div id="loginView" class="view active">
            <section id="loginSection">
                <h2 data-translate="login_heading">Login</h2>
                <input type="text" id="username" placeholder="Username">
                <input type="password" id="password" placeholder="Password">
                <select id="role">
                    <option value="student" data-translate="role_student">Student</option>
                    <option value="teacher" data-translate="role_teacher">Teacher</option>
                    <option value="admin" data-translate="role_admin">Admin</option>
                </select>
                <button onclick="auth.login()" data-translate="login_button">Login</button>
            </section>
        </div>

        <div id="studentView" class="view">
            <section>
                <h2 id="studentWelcomeMsg"></h2>
                <p id="studentStreak"></p>
                <button onclick="auth.logout()" class="logout-btn" data-translate="logout_button">Logout</button>
            </section>
            <div class="dashboard-grid">
                <section>
                    <h3 data-translate="ebook_title">Interactive eBook</h3>
                    <p data-translate="ebook_desc">Click on a word to see its meaning:</p>
                    <textarea placeholder="Write your notes here..."></textarea>
                </section>

                <section>
                    <h3 data-translate="video_title">Video Lecture</h3>
                </section>

                <section>
                    <h3 data-translate="quiz_title">Quiz</h3>
                    <p data-translate="quiz_question">Q1: What does 'Shiksha' mean?</p>
                    <button onclick="studentFeatures.checkQuizAnswer(this, true)" data-translate="quiz_option1">Education</button>
                    <button onclick="studentFeatures.checkQuizAnswer(this, false)" data-translate="quiz_option2">Bridge</button>
                    <p id="quizResult"></p>
                </section>
                
                <section>
                    <h3 data-translate="practice_title">Practice Section</h3>
                    <button onclick="studentFeatures.generateProblem()" data-translate="practice_generate">Generate Problem</button>
                    <p id="problem"></p>
                    <input type="number" id="answerInput" placeholder="Your Answer">
                    <button onclick="studentFeatures.checkProblem()" data-translate="practice_submit">Submit</button>
                    <p id="practiceResult"></p>
                </section>

                <section>
                    <h3 data-translate="career_title">Career Guidance</h3>
                    <label for="classSelect" data-translate="career_select_class">Select Your Class:</label>
                </section>
            </div>
        </div>
        
        <div id="teacherView" class="view">
             <section>
                <h2 id="teacherWelcomeMsg"></h2>
                <button onclick="auth.logout()" class="logout-btn" data-translate="logout_button">Logout</button>
            </section>
        </div>

        <div id="adminView" class="view">
             <section>
                <h2 id="adminWelcomeMsg"></h2>
                <button onclick="auth.logout()" class="logout-btn" data-translate="logout_button">Logout</button>
            </section>
        </div>
    </main>

    <script>
        // ======================= GLOBAL STATE & TRANSLATIONS =======================
        const state = {
            currentUser: null,
            currentView: 'loginView',
            currentLanguage: 'en'
        };

        const translations = {
            en: {
                app_title: "Shiksha Setu",
                login_heading: "Login",
                role_student: "Student",
                role_teacher: "Teacher",
                role_admin: "Admin",
                login_button: "Login",
                logout_button: "Logout",
                welcome_message: "Welcome, {username} ({role})",
                streak_message: "Login Streak: {streak}",
                ebook_title: "Interactive eBook",
                ebook_desc: "Click on a word to see its meaning:",
                video_title: "Video Lecture",
                quiz_title: "Quiz",
                quiz_question: "Q1: What does 'Shiksha' mean?",
                quiz_option1: "Education",
                quiz_option2: "Bridge",
                practice_title: "Practice Section",
                practice_generate: "Generate Problem",
                practice_submit: "Submit",
                career_title: "Career Guidance",
                career_select_class: "Select Your Class:",
            },
            hi: {
                app_title: "शिक्षा सेतु",
                login_heading: "लॉगिन",
                role_student: "विद्यार्थी",
                role_teacher: "शिक्षक",
                role_admin: "एडमिन",
                login_button: "लॉगिन करें",
                logout_button: "लॉगआउट",
                welcome_message: "स्वागत है, {username} ({role})",
                streak_message: "लॉगिन स्ट्रीक: {streak}",
                ebook_title: "इंटरैक्टिव ईबुक",
                ebook_desc: "इसका अर्थ देखने के लिए किसी शब्द पर क्लिक करें:",
                video_title: "वीडियो व्याख्यान",
                quiz_title: "प्रश्नोत्तरी",
                quiz_question: "Q1: 'शिक्षा' का क्या अर्थ है?",
                quiz_option1: "शिक्षा",
                quiz_option2: "सेतु",
                practice_title: "अभ्यास",
                practice_generate: "समस्या उत्पन्न करें",
                practice_submit: "जमा करें",
                career_title: "करियर मार्गदर्शन",
                career_select_class: "अपनी कक्षा चुनें:",
            },
            pa: {
                app_title: "ਸਿੱਖਿਆ ਸੇਤੁ",
                login_heading: "ਲਾਗਇਨ",
                role_student: "ਵਿਦਿਆਰਥੀ",
                role_teacher: "ਅਧਿਆਪਕ",
                role_admin: "ਐਡਮਿਨ",
                login_button: "ਲਾਗਇਨ ਕਰੋ",
                logout_button: "ਲਾਗਆਉਟ",
                welcome_message: "ਜੀ ਆਇਆਂ ਨੂੰ, {username} ({role})",
                streak_message: "ਲੌਗਇਨ ਸਟ੍ਰੀਕ: {streak}",
                ebook_title: "ਇੰਟਰਐਕਟਿਵ ਈ-ਬੁੱਕ",
                ebook_desc: "ਇਸਦਾ ਅਰਥ ਦੇਖਣ ਲਈ ਇੱਕ ਸ਼ਬਦ 'ਤੇ ਕਲਿੱਕ ਕਰੋ:",
                video_title: "ਵੀਡੀਓ ਲੈਕਚਰ",
                quiz_title: "ਕਵਿਜ਼",
                quiz_question: "Q1: 'ਸਿੱਖਿਆ' ਦਾ ਕੀ ਅਰਥ ਹੈ?",
                quiz_option1: "ਸਿੱਖਿਆ",
                quiz_option2: "ਪੁਲ",
                practice_title: "ਅਭਿਆਸ",
                practice_generate: "ਸਮੱਸਿਆ ਬਣਾਓ",
                practice_submit: "ਜਮ੍ਹਾਂ ਕਰੋ",
                career_title: "ਕਰੀਅਰ ਮਾਰਗਦਰਸ਼ਨ",
                career_select_class: "ਆਪਣੀ ਕਲਾਸ ਚੁਣੋ:",
            }
        };

        // ======================= CORE FUNCTIONS =======================
        
        /**
         * ⭐️ **NEW: This function translates the entire UI.**
         * It finds all elements with a 'data-translate' attribute and updates their text.
         */
        function applyTranslations() {
            const lang = state.currentLanguage;
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang][key]) {
                    element.innerText = translations[lang][key];
                }
            });
        }

        // Utility to switch between views
        function navigateTo(viewId) {
            document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            state.currentView = viewId;
        }

        // ======================= AUTHENTICATION MODULE =======================
        const auth = {
            login: function() {
                const username = document.getElementById('username').value;
                const role = document.getElementById('role').value;
                if (!username) { alert("Please enter a username."); return; }

                state.currentUser = { username, role };
                const streak = parseInt(localStorage.getItem('streak') || 0) + 1;
                localStorage.setItem('user', JSON.stringify(state.currentUser));
                localStorage.setItem('streak', streak);

                this.showDashboard(streak);
            },
            logout: function() {
                state.currentUser = null;
                localStorage.removeItem('user');
                navigateTo('loginView');
                applyTranslations(); // Re-translate the login page after logout
            },
            showDashboard: function(streak) {
                const { role, username } = state.currentUser;
                let viewId, welcomeMsgId, streakId;

                if (role === 'student') {
                    viewId = 'studentView';
                    welcomeMsgId = 'studentWelcomeMsg';
                    streakId = 'studentStreak';
                } else if (role === 'teacher') {
                    viewId = 'teacherView';
                    welcomeMsgId = 'teacherWelcomeMsg';
                } else { // admin
                    viewId = 'adminView';
                    welcomeMsgId = 'adminWelcomeMsg';
                }

                navigateTo(viewId);
                
                // This part now handles dynamic text replacement
                const lang = state.currentLanguage;
                const welcomeText = translations[lang].welcome_message
                    .replace('{username}', username)
                    .replace('{role}', role);
                document.getElementById(welcomeMsgId).innerText = welcomeText;

                if (streakId) {
                    const streakText = translations[lang].streak_message.replace('{streak}', streak);
                    document.getElementById(streakId).innerText = streakText;
                }
                
                // ⭐ **CRITICAL FIX:** Apply translations to the newly visible dashboard
                applyTranslations();
            }
        };

        // (Other modules like studentFeatures, careerGuidance remain the same)
        const studentFeatures = { checkQuizAnswer: function(b,c){document.getElementById('quizResult').innerText=c?"✅ Correct!":"❌ Wrong!"}, generateProblem: function(){const a=Math.floor(Math.random()*10)+1,b=Math.floor(Math.random()*10)+1;state.quiz={currentAnswer:a+b};document.getElementById('problem').innerText=`What is ${a} + ${b}?`;document.getElementById('practiceResult').innerText=""}, checkProblem: function(){const a=parseInt(document.getElementById('answerInput').value);document.getElementById('practiceResult').innerText=a===state.quiz.currentAnswer?"✅ Correct!":"❌ Wrong!"} };
        
        // ======================= EVENT LISTENERS & INITIALIZATION =======================
        
        // ⭐ **IMPROVED:** Event listener now calls the main translation function
        document.getElementById('languageSwitcher').addEventListener('change', (e) => {
            state.currentLanguage = e.target.value;
            applyTranslations();

            // If a user is already logged in, update their dynamic info too
            if (state.currentUser) {
                const streak = parseInt(localStorage.getItem('streak') || 1);
                auth.showDashboard(streak);
            }
        });

        window.onload = () => {
            const savedUser = localStorage.getItem('user');
            if (savedUser) {
                state.currentUser = JSON.parse(savedUser);
                const streak = parseInt(localStorage.getItem('streak') || 1);
                auth.showDashboard(streak);
            } else {
                navigateTo('loginView');
            }
            // Apply translations on initial page load
            applyTranslations(); 
        };
    </script>
</body>
</html>
